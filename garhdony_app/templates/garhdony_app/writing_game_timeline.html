{% extends "garhdony_app/base_writer_game.html" %}
{% load garhdony_tags %}
{% load static %}

{% block title %}{{game.name}} Timeline{% endblock %}

{% block morehead %}
<script src="{% static 'garhdony_app/timeline.js' %}"></script>
<link rel="stylesheet" href="{% static 'garhdony_app/sheets.css' %}"> {# for the timeline styling #}
{% endblock %}

{% block content %}
Mouse over a sheet to see their description of the event.
<table class='timeline' id="timeline">
<tbody>
  {% for event in timeline.events.all %}
    <tr data-event={{event.id}}>
        <td class="date"> 
          {% with field='event-'|concat:event.id|concat:'-date' %}
          {% writable_field field %}
          {% edit_button %}
          {% display %}
          {{event.date}}
          {% edit %}
          <div>
            {{ edit_form.day }} {{ edit_form.day.errors }}
          </div>
          <div>
            {{ edit_form.month }} {{ edit_form.month.errors }}
          </div>
          <div>
            {{ edit_form.year }} {{ edit_form.year.errors }}
          </div>
          {% end_writable_field %}
          {% endwith %}
        </td>
        <td class="name">
          {% with field='event-'|concat:event.id|concat:'-internal_name' %}
          {% writable_field field %}
          {% edit_button %}
          {% display %}
          {{event.internal_name}}
          {% edit %}
          <div>
            {{ edit_form.internal_name }} {{ edit_form.internal_name.errors }}
          </div>
          {% end_writable_field %}
          {% endwith %}
        </td>
        <td class="sheets">
          {% if event.descriptions.count == 0 %}
            {# ajax button to delete the event #}
            <form action="{% url 'timeline_delete_event' game.name event.id %}" method="post" class="delete-event">
              {% csrf_token %}
              <button type="submit">Delete</button>
            </form>
          {% endif %}
          {% for desc in event.descriptions.all %}
              <a href="{% url 'writer_sheet' game.name desc.viewer.sheet.filename%}" title={{desc.description}} class="individual-sheet">
                  {{desc.viewer.sheet.filename}}
              </a>
              {# Spacing them out #}
              {% if not forloop.last %}
                  <span class="sheet-separator">, </span>
              {% endif %}
          {% endfor %}
      </td>
    </tr>  
  {% endfor %}
</tbody>
</table>
{% endblock %}